<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>헌법 인포그래픽 모음</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Noto Sans KR 폰트 로드 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f0f4f8; /* 노무사 페이지와 동일한 은은한 배경색 */
      color: #2d3748;
      line-height: 1.6;
    }
    .header-bg {
      background: linear-gradient(135deg, #4a90e2, #63b3ed); /* 헤더 그라데이션 */
    }
    .card {
      /* 고급스러운 디자인을 위한 스타일 수정 */
      background: linear-gradient(to top right, #ffffff, #f0f9ff); /* 옅은 그라데이션 배경 */
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
      padding: 1.5rem 2rem;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      text-decoration: none;
      color: inherit;
      border: 1px solid #e5e7eb; /* 옅은 테두리 추가 */
      border-left: 4px solid #4a90e2; /* 왼쪽 강조선 */
    }
    .card:hover {
      transform: translateY(-5px); /* 호버 효과 강화 */
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      cursor: pointer;
    }
    .section-title {
      color: #2a69ac;
      position: relative;
      padding-bottom: 0.5rem;
    }
    .section-title::after {
      content: '';
      position: absolute;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 60px;
      height: 4px;
      background-color: #4a90e2;
      border-radius: 2px;
    }
    /* 애니메이션 */
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-down { animation: fadeInDown 0.8s ease-out forwards; }
    .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
  </style>
</head>
<body>

  <!-- 헤더 섹션 -->
  <header class="header-bg text-white py-12 md:py-16 text-center shadow-lg">
    <div class="container mx-auto px-4">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-fade-in-down">
        대한민국 헌법 인포그래픽
      </h1>
      <p class="text-xl md:text-2xl opacity-90 animate-fade-in-up">
        복잡한 헌법 조항을 인포그래픽으로 쉽고 명확하게 이해하세요.
      </p>
      <div class="mt-8 max-w-2xl mx-auto animate-fade-in-up">
        <div class="flex items-center justify-between p-2 bg-white/20 rounded-lg">
          <input id="q" type="search" placeholder="예: 제10조, 기본권, 자유..." class="w-full bg-transparent text-white placeholder-gray-200 border-0 focus:ring-0 text-lg px-4 py-2">
          <div id="count" class="text-gray-200 text-sm whitespace-nowrap pr-4"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- 메인 콘텐츠 섹션 -->
  <main class="container mx-auto px-4 py-12 md:py-16">
    <section class="text-center">
      <h2 class="text-3xl md:text-4xl font-bold section-title mb-12">
        헌법 조항 목록
      </h2>
      <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8 max-w-5xl mx-auto" aria-live="polite">
        <!-- JavaScript로 카드들이 채워질 영역 -->
      </div>
      <div class="mt-12 flex gap-4 items-center justify-center">
        <button id="prev" class="px-4 py-2 bg-white text-gray-700 rounded-lg shadow disabled:opacity-50 transition hover:bg-gray-100">&larr; 이전</button>
        <span id="pageInfo" class="text-gray-600 text-lg font-semibold"></span>
        <button id="next" class="px-4 py-2 bg-white text-gray-700 rounded-lg shadow disabled:opacity-50 transition hover:bg-gray-100">다음 &rarr;</button>
      </div>
    </section>
  </main>

  <!-- 푸터 섹션 -->
  <footer class="bg-gray-800 text-white py-8 text-center mt-16">
    <div class="container mx-auto px-4">
      <p>&copy; 2024 Constitution Infographics. All rights reserved.</p>
      <p class="mt-2 text-sm opacity-80">
        본 페이지는 교육 목적으로 제작되었습니다.
      </p>
    </div>
  </footer>

  <script>
    const OWNER = "JustinKim0324";
    const REPO = "constitution";
    const PAGE_SIZE = 12; // 2열 레이아웃에 맞게 조정

    let all = [], filtered = [], page = 1;
    const q = document.getElementById('q');
    const grid = document.getElementById('grid');
    const count = document.getElementById('count');
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const pageInfo = document.getElementById('pageInfo');

    const contentCache = new Map();

    async function fetchArticleContent(path) {
      if (contentCache.has(path)) {
        return contentCache.get(path);
      }
      try {
        // GitHub Pages Raw URL을 생성하여 fetch 요청
        const fullUrl = `https://${OWNER}.github.io/${REPO}/${path}`;
        const response = await fetch(fullUrl);
        if (!response.ok) return "내용을 불러올 수 없습니다.";
        const html = await response.text();
        const doc = new DOMParser().parseFromString(html, "text/html");
        const articleDiv = doc.querySelector('.article');
        let content = articleDiv ? articleDiv.textContent.trim().replace(/\s+/g, ' ') : "내용을 찾을 수 없습니다.";
        contentCache.set(path, content);
        return content;
      } catch (error) {
        console.error(`Error fetching article content for ${path}:`, error);
        return "내용 로딩 중 오류 발생";
      }
    }

    async function fetchAllHtmlFiles() {
      let items = [];
      try {
        const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`GitHub API Error: ${res.status}`);
        const data = await res.json();
        items = data.filter(item => item.type === 'file' && item.name.endsWith('.html') && item.name.toLowerCase() !== 'index.html');
      } catch (error) {
        console.error("Error fetching file list:", error);
        grid.innerHTML = `<p class="text-red-500 col-span-full">데이터를 불러오는 데 실패했습니다. GitHub API 속도 제한에 도달했을 수 있습니다.</p>`;
        return [];
      }
      
      items.sort((a, b) => {
          const numA = parseInt(a.name.match(/\d+/)?.[0] || 0);
          const numB = parseInt(b.name.match(/\d+/)?.[0] || 0);
          if (numA !== numB) return numA - numB;
          return a.name.localeCompare(b.name, 'ko');
      });
      
      return items.map(x => ({
        title: x.name.replace(/\.html$/i, ''),
        href: x.name,
        path: x.path
      }));
    }

    function normalize(s) {
      return (s || "").toString().toLowerCase().normalize('NFKD');
    }

    async function render() {
      const start = (page - 1) * PAGE_SIZE;
      const end = start + PAGE_SIZE;
      const pageItems = filtered.slice(start, end);

      if(pageItems.length === 0 && q.value) {
        grid.innerHTML = `<p class="text-gray-500 col-span-full">검색 결과가 없습니다.</p>`;
      } else {
        const cardsHtml = await Promise.all(pageItems.map(async it => {
          let content = await fetchArticleContent(it.href);
          if (content.length > 80) { // 글자 수를 약간 줄여서 레이아웃이 깨지지 않도록 조정
            content = content.substring(0, 80) + '...';
          }
          return `
            <a href="${encodeURI(it.href)}" target="_blank" rel="noopener" class="card">
                <div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${escapeHtml(it.title)}</h3>
                    <p class="text-gray-800 text-lg font-semibold mb-4">${escapeHtml(content)}</p>
                </div>
                <div class="mt-auto pt-4 text-right text-blue-600 font-bold">자세히 보기 &rarr;</div>
            </a>`;
        }));
        grid.innerHTML = cardsHtml.join('');
      }

      count.textContent = `총 ${filtered.length}개`;
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      pageInfo.textContent = `${page} / ${totalPages}`;
      prev.disabled = page <= 1;
      next.disabled = page >= totalPages;
    }

    function search(term) {
      const t = normalize(term);
      if (!t) {
        filtered = all.slice();
      } else {
        filtered = all.filter(it => {
          const title = normalize(it.title);
          
          // 1. 기본적으로 검색어를 포함해야 함
          const index = title.indexOf(t);
          if (index === -1) {
            return false;
          }
          
          // 2. 검색어가 숫자로 시작하고 '조'로 끝나는 경우(예: "1조"), 더 정확한 매칭
          const match = t.match(/^(\d+조)/);
          if (match) {
            // "헌법 1조" 와 같이 정확히 일치하는 경우만 찾도록 정규식 사용
            const exactMatchRegex = new RegExp(`헌법 ${match[1]}`);
            return normalize(it.title).match(exactMatchRegex);
          }
          
          // 3. 검색어가 숫자로만 이루어진 경우
          if (/^\d+$/.test(t)) {
             const exactMatchRegex = new RegExp(`헌법 ${t}조`);
             if (normalize(it.title).match(exactMatchRegex)) {
               return true;
             }
          }

          // 그 외의 경우, 단순 포함 여부로 검색
          if (index > 0 && /\d/.test(title[index - 1])) {
             if (/^\d/.test(t)) return false;
          }
          
          return true;
        });
      }
      page = 1;
      render();
    }

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, c => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'}[c]));
    }

    prev.addEventListener('click', () => { if (page > 1) { page--; render(); window.scrollTo(0,0); } });
    next.addEventListener('click', () => { const totalPages = Math.ceil(filtered.length / PAGE_SIZE); if (page < totalPages) { page++; render(); window.scrollTo(0,0); } });
    q.addEventListener('input', e => search(e.target.value));

    (async function init() {
      grid.innerHTML = `<p class="text-gray-500 col-span-full">헌법 조항 목록을 불러오는 중입니다...</p>`;
      all = await fetchAllHtmlFiles();
      filtered = all.slice();
      render();
    })();
  </script>

</body>
</html>

